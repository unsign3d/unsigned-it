<!doctype html><html lang=en-us><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge,chrome=1"><title>Communication between microservices | Random thoughts and ideas</title><meta name=viewport content="width=device-width,minimum-scale=1"><meta name=description content="Communication between microservices, does and don't "><meta name=generator content="Hugo 0.110.0"><meta name=robots content="noindex, nofollow"><link rel=stylesheet href=/ananke/css/main.min.css><link href=/posts/communication-between-microservices/index.xml rel=alternate type=application/rss+xml title="Random thoughts and ideas"><link href=/posts/communication-between-microservices/index.xml rel=feed type=application/rss+xml title="Random thoughts and ideas"><meta property="og:title" content="Communication between microservices"><meta property="og:description" content="Communication between microservices, does and don't "><meta property="og:type" content="article"><meta property="og:url" content="https://lucabruzzone.me/posts/communication-between-microservices/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2020-07-01T12:44:00+00:00"><meta property="article:modified_time" content="2020-07-01T12:44:00+00:00"><meta itemprop=name content="Communication between microservices"><meta itemprop=description content="Communication between microservices, does and don't "><meta itemprop=datePublished content="2020-07-01T12:44:00+00:00"><meta itemprop=dateModified content="2020-07-01T12:44:00+00:00"><meta itemprop=wordCount content="1256"><meta itemprop=keywords content="microservices,"><meta name=twitter:card content="summary"><meta name=twitter:title content="Communication between microservices"><meta name=twitter:description content="Communication between microservices, does and don't "></head><body class="ma0 avenir bg-near-white"><header class="cover bg-top" style=background-image:url(https://lucabruzzone.me/images/pexels-designecologist-1366178.webp)><div class=bg-black-60><nav class="pv3 ph3 ph4-ns" role=navigation><div class="flex-l justify-between items-center center"><a href=/ class="f3 fw2 hover-white no-underline white-90 dib">Random thoughts and ideas</a><div class="flex-l items-center"><div class=ananke-socials><a href=/about-gdpr-tc target=_blank rel=noopener class="About me / GDPR / T&C ananke-social-link link-transition stackoverflow link dib z-999 pt3 pt0-l mr1" title="About me / GDPR / T&C link" aria-label="follow on About me / GDPR / T&C——Opens in a new window">About me / GDPR / T&C
<span class=new-window><svg height="8" style="enable-background:new 0 0 1000 1000" viewBox="0 0 1e3 1e3" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M598 128h298v298h-86V274L392 692l-60-60 418-418H598v-86zM810 810V512h86v298c0 46-40 86-86 86H214c-48 0-86-40-86-86V214c0-46 38-86 86-86h298v86H214v596h596z" style="fill-rule:evenodd;clip-rule:evenodd"/></svg></span></a><a href=https://mstdn.social/@unsigned target=_blank rel=noopener class="mastodon ananke-social-link link-transition stackoverflow link dib z-999 pt3 pt0-l mr1" title="Mastodon link" aria-label="follow on Mastodon——Opens in a new window"><span class=icon><svg style="enable-background:new 0 0 67 67" viewBox="0 0 67 67" xmlns="http://www.w3.org/2000/svg"><path d="M61.731833 16.783448C60.855064 10.336694 55.17491 5.2562169 48.441526 4.2717554 47.305526 4.1054038 43.001372 3.5 33.030833 3.5h-.07446c-9.973232.0-12.112924.6054038-13.248924.7717554C13.161526 5.2289477 7.1836569 9.7940169 5.7332999 16.317063c-.6976035 3.212462-.7720515 6.774-.6424569 10.041.1847407 4.685077.2205861 9.361923.6507292 14.027923.2973693 3.099385.8161231 6.174077 1.552377 9.201 1.3786615 5.590462 6.9594998 10.242769 12.4272688 12.140846 5.854077 1.979385 12.149615 2.307923 18.181846.949.663539-.152692 1.319846-.33 1.968693-.531769 1.464153-.460846 3.182-.976308 4.444846-1.881692.01731-.01269.03154-.02908.04154-.048.01-.01885.01562-.03977.01631-.06108v-4.521385c-308e-6-.01992-.0051-.03954-.014-.05738-.009-.01785-.02185-.03354-.03777-.04577-.01585-.01231-.03431-.02092-.05392-.02531-.01969-.0043-.04008-.0042-.05969 23e-5-3.864769.913077-7.825154 1.370769-11.798615 1.363539-6.838154.0-8.677308-3.209693-9.204-4.546-.423308-1.154846-.692154-2.359462-.799615-3.583308-.0011-.02054.0028-.04108.01115-.05992.0084-.01877.02123-.03538.03731-.04839.01615-.013.03515-.02208.05546-.02646.02031-.0045.04138-.004.06154.0012 3.800385.906846 7.696154 1.364538 11.605615 1.363538.940231.0 1.877693.0 2.818-.02454 3.931923-.109077 8.076154-.308154 11.944693-1.055385.09654-.01908.193-.03546.275769-.06 6.101923-1.159 11.908846-4.796846 12.498923-14.008846.02208-.362692.07723-3.798769.07723-4.175077.0028-1.279.416384-9.072846-.06069-13.861538zm-9.391461 22.98623H45.924141V24.225525c0-3.272462-1.378692-4.941385-4.182923-4.941385-3.082692.0-4.626769 1.974385-4.626769 5.874v8.508385H30.736757V25.15814c0-3.899615-1.546847-5.874-4.629539-5.874-2.787692.0-4.180154 1.668923-4.182923 4.941385V39.769678H15.513526V23.753755c0-3.272461.844692-5.87223 2.534-7.799384 1.742615-1.922539 4.028461-2.909693 6.865769-2.909693 3.283923.0 5.765538 1.248923 7.419923 3.744231l1.596539 2.650692 1.59923-2.650692c1.654385-2.495308 4.136-3.744231 7.414462-3.744231 2.834538.0 5.120308.987154 6.868461 2.909693 1.689385 1.925307 2.534 4.525077 2.534 7.799384z" style="fill-rule:evenodd;clip-rule:evenodd"/></svg></span><span class=new-window><svg height="8" style="enable-background:new 0 0 1000 1000" viewBox="0 0 1e3 1e3" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M598 128h298v298h-86V274L392 692l-60-60 418-418H598v-86zM810 810V512h86v298c0 46-40 86-86 86H214c-48 0-86-40-86-86V214c0-46 38-86 86-86h298v86H214v596h596z" style="fill-rule:evenodd;clip-rule:evenodd"/></svg></span></a><a href=https://github.com/unsign3d target=_blank rel=noopener class="github ananke-social-link link-transition stackoverflow link dib z-999 pt3 pt0-l mr1" title="GitHub link" aria-label="follow on GitHub——Opens in a new window"><span class=icon><svg style="enable-background:new 0 0 512 512" viewBox="0 0 512 512" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M256 32C132.3 32 32 134.8 32 261.7c0 101.5 64.2 187.5 153.2 217.9 11.2 2.1 15.3-5 15.3-11.1.0-5.5-.2-19.9-.3-39.1-62.3 13.9-75.5-30.8-75.5-30.8-10.2-26.5-24.9-33.6-24.9-33.6-20.3-14.3 1.5-14 1.5-14 22.5 1.6 34.3 23.7 34.3 23.7 20 35.1 52.4 25 65.2 19.1 2-14.8 7.8-25 14.2-30.7-49.7-5.8-102-25.5-102-113.5.0-25.1 8.7-45.6 23-61.6-2.3-5.8-10-29.2 2.2-60.8.0.0 18.8-6.2 61.6 23.5 17.9-5.1 37-7.6 56.1-7.7 19 .1 38.2 2.6 56.1 7.7 42.8-29.7 61.5-23.5 61.5-23.5 12.2 31.6 4.5 55 2.2 60.8 14.3 16.1 23 36.6 23 61.6.0 88.2-52.4 107.6-102.3 113.3 8 7.1 15.2 21.1 15.2 42.5.0 30.7-.3 55.5-.3 63 0 6.1 4 13.3 15.4 11C415.9 449.1 480 363.1 480 261.7 480 134.8 379.7 32 256 32z"/></svg></span><span class=new-window><svg height="8" style="enable-background:new 0 0 1000 1000" viewBox="0 0 1e3 1e3" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M598 128h298v298h-86V274L392 692l-60-60 418-418H598v-86zM810 810V512h86v298c0 46-40 86-86 86H214c-48 0-86-40-86-86V214c0-46 38-86 86-86h298v86H214v596h596z" style="fill-rule:evenodd;clip-rule:evenodd"/></svg></span></a></div></div></div></nav><div class="tc-l pv6 ph3 ph4-ns"><div class="f2 f1-l fw2 white-90 mb0 lh-title">Communication between microservices</div><div class="fw1 f5 f3-l white-80 measure-wide-l center lh-copy mt3 mb4">Communication between microservices, does and don't</div></div></div></header><main class=pb7 role=main><article class="flex-l flex-wrap justify-between mw8 center ph3"><header class="mt4 w-100"><aside class="instapaper_ignoref b helvetica tracked">POSTS</aside><div id=sharing class="mt3 ananke-socials"></div><h1 class="f1 athelas mt3 mb1">Communication between microservices</h1><p class=tracked>By <strong>Luca Bruzzone</strong></p><time class="f6 mv4 dib tracked" datetime=2020-07-01T12:44:00Z>July 1, 2020</time></header><div class="nested-copy-line-height lh-copy serif f4 nested-links mid-gray pr4-l w-two-thirds-l"><p>This article was written and published 2020–01–07 on my personal blog, this is a repost</p><h1 id=the-problem>The problem</h1><p>Let’s say that you’re developing a software in a monolithic approach and you need to create a new functionality. What you will probably do is to search or define a new “business identity” and from there create what you need. If you need to expose something, you will create appropriate APIs, and if you need something from somewhere else, you will just call that method on that class.</p><p>When you’re switching to micro-services, or generally a distributed system, this could get a bit complicated because you will have bits of information everywhere and you will start to have complexity rising.</p><h1 id=just-call-it-approach>“Just call it” approach</h1><p>Let’s imagine that you have a main system and you want to create for now just a small micro-service that is offloading from the main server a small task that is heavy on load. Typical example of this, could be a PDF generation.</p><p>The most cost effective solution probably here could be creating the PDF generation “as a service” with an HTTP API (you have a bunch of choice for the protocol to use, you have REST, [g]RPC, GraphQL and many others).</p><p>If you’re using some server-less platform (like AWS Lambda), you may also have the SDK with method of communication already provided to you. In my experience, usually that is the most reliable method because it’s “optimized” by your vendor. Of course, if you’re not careful and you’re building your software entirely based on a 3rd party SDK and that changes, or you want to change vendor, this is usually a bad idea</p><h1 id=in-a-more-familiar-manner>In a more familiar manner</h1><p>You can think about this method as the traditional “service class” method, you’re delegating something to a class, and you are calling it. This just happens over the network</p><h1 id=pros>Pros</h1><ul><li>This is probably the simplest method that you can implement, it’s very junior-friendly and you will not have to explain and/or maintain complex architecture</li><li>It’s probably the method with the less moving parts (since you’re not relying on a 3rd service for maintaining the documentation)</li><li>It’s kinda easy to debug, you can associate a “request id” to the entirety of the request and you can see the whole flow of the request from your customer to the server that presented a problem</li><li>You can implement synchronous call to that server and make the client wait for that request (useful in some cases like payment or image manipulation)</li></ul><h1 id=cons>Cons</h1><ul><li>You will need to maintain an API, with versioning</li><li>You will have a strong coupling, since the caller will need to know the existence of the server and how to communicate with it.</li><li>You will need to take into consideration network latency, downstream service being not ready or reliable and everything that comes with and external service, even if the service is internal</li></ul><h1 id=message-driven-architecture>Message driven architecture</h1><p>This is a huge class of possibilities, here I will just touch the basics and the pros/cons of this approach.</p><p>I will create more articles about multiple possibilities of implementing this ideology.</p><h1 id=change-in-perspective>Change in perspective</h1><p>If you choose to approach this ideology, you will need to shift from the paradigm of A asking to B something, and maybe B to reply to a more inverse approach. If you have already worked with the observer pattern, this will be more natural.</p><p>Let’s take the old example of the invoice PDF generation.</p><p>In a traditional architecture you would have the main service creating the invoice and then asking a service to generate the PDF, when the PDF is created you will serve it in some way</p><p>In a message oriented architecture you have multiple players.</p><ul><li><strong>A producer</strong>: a software that create something and “announce it” to the public</li><li><strong>A consumer</strong>: a software that get the “message” and consumes it</li><li><strong>A communication middleware / messaging system</strong>: It could be a message queue (RabbitMQ / ZeroMQ), a distributed logging (Apache Kafka) or anything that you can imagine</li></ul><p>In the case of the example we will have our main application that <strong>temporarily</strong> acts as a producer and announces to the middleware that the invoice is complete. The pdf generator will listen for messages and will <strong>temporarily</strong> act as a consumer, taking all the information that he needs from the PDF generation and maybe he can also act as a producer and announce to the ecosystem that the PDF is ready (e.g.. you can have another service down the line that will take the PDF and sends it via email)</p><h1 id=pros-1>Pros</h1><p>As you can imagine already you will have an <strong>extreme decoupling</strong> between services, if you’re sending enough information to describe the business action, everyone will be able to work without knowing about the consumers internal. This is usually why when you will start to encounter this kind of architectures when the project is expanding and more developers are joining, this is a typical architecture that you put in place to get to team independency</p><p>The log of the message could become a source to understand what is happening in your whole ecosystem, you can also take those data and create some analysis</p><h1 id=cons-1>Cons</h1><ul><li>Your communication middleware will become quickly your bottleneck</li><li>Usually you don’t have guaranteed orders on the events, so you will need to create your code to adjust for those situations</li><li>Duplication of similar events</li><li>Difficulty of handling failures (in some cases you may have data loss, in some systems, data loss is actually taken into consideration and the ecosystem is built around it)</li><li>Depending on the complexity of the project you will be unable to understand the full picture of what it’s going on after an action (as soon as you will embrace it, this will not be a problem anymore)</li></ul><h1 id=why-should-i-use-it-then-if-its-so-complicated>Why should I use it then if it’s so complicated</h1><p><strong>tl;dr</strong> usually it grows better and gives way fewer problems than similar alternatives, most of the problems are already solved for you and there is enough literature to not being afraid</p><p><strong>The long answer</strong></p><p>If you need to have synchronous replies, this method is not the go-to. Just find some method to communicate directly and use it.</p><p>If you’re not in a rush and you can do stuff in a more asynchronous way you can have a lot more advantages with this approach. If you have already used the observer pattern you will be more appreciative of this.</p><p>Let’s take an example of a payment, as soon as the payment is complete you want to do the following:</p><ul><li>create an invoice</li><li>register somewhere that the user paid for accountancy</li><li>unlock features / start the wearhouse procedure for shipment</li><li>update the CRM system</li><li>update other ERP systems</li><li>update dashboards</li><li>that thing that the other team is working on, but it’s a test, so it doesn’t really work that much</li><li>yeah we wanted also to do some tests, does the team have capacity?</li></ul><p>This list of things has a couple of interesting properties:</p><ul><li>everything can be done in parallel</li><li>probably some of these points we don’t even want to know what is happening, and we would like to delegate it to other teams</li></ul><p>As soon as you’re publishing in the event pipeline that the payment is complete, you don’t need to care anymore about anything else (if you’re not in charge of the other systems). Also, if you look at the quantity of stuff that you will need to do, you will see that if you parallelize it you may save a lot of time</p><ul class=pa0><li class="list di"><a href=/tags/microservices/ class="link f5 grow no-underline br-pill ba ph3 pv2 mb2 dib black sans-serif">microservices</a></li></ul><div class="mt6 instapaper_ignoref"></div></div><aside class="w-30-l mt6-l"></aside></article></main><footer class="bg-black bottom-0 w-100 pa3" role=contentinfo><div class="flex justify-between"><a class="f4 fw4 hover-white no-underline white-70 dn dib-ns pv2 ph3" href=https://lucabruzzone.me/>&copy; All content is under CC BY-SA license. Luca Bruzzone 2023</a><div><div class=ananke-socials><a href=/about-gdpr-tc target=_blank rel=noopener class="About me / GDPR / T&C ananke-social-link link-transition stackoverflow link dib z-999 pt3 pt0-l mr1" title="About me / GDPR / T&C link" aria-label="follow on About me / GDPR / T&C——Opens in a new window">About me / GDPR / T&C
<span class=new-window><svg height="8" style="enable-background:new 0 0 1000 1000" viewBox="0 0 1e3 1e3" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M598 128h298v298h-86V274L392 692l-60-60 418-418H598v-86zM810 810V512h86v298c0 46-40 86-86 86H214c-48 0-86-40-86-86V214c0-46 38-86 86-86h298v86H214v596h596z" style="fill-rule:evenodd;clip-rule:evenodd"/></svg></span></a><a href=https://mstdn.social/@unsigned target=_blank rel=noopener class="mastodon ananke-social-link link-transition stackoverflow link dib z-999 pt3 pt0-l mr1" title="Mastodon link" aria-label="follow on Mastodon——Opens in a new window"><span class=icon><svg style="enable-background:new 0 0 67 67" viewBox="0 0 67 67" xmlns="http://www.w3.org/2000/svg"><path d="M61.731833 16.783448C60.855064 10.336694 55.17491 5.2562169 48.441526 4.2717554 47.305526 4.1054038 43.001372 3.5 33.030833 3.5h-.07446c-9.973232.0-12.112924.6054038-13.248924.7717554C13.161526 5.2289477 7.1836569 9.7940169 5.7332999 16.317063c-.6976035 3.212462-.7720515 6.774-.6424569 10.041.1847407 4.685077.2205861 9.361923.6507292 14.027923.2973693 3.099385.8161231 6.174077 1.552377 9.201 1.3786615 5.590462 6.9594998 10.242769 12.4272688 12.140846 5.854077 1.979385 12.149615 2.307923 18.181846.949.663539-.152692 1.319846-.33 1.968693-.531769 1.464153-.460846 3.182-.976308 4.444846-1.881692.01731-.01269.03154-.02908.04154-.048.01-.01885.01562-.03977.01631-.06108v-4.521385c-308e-6-.01992-.0051-.03954-.014-.05738-.009-.01785-.02185-.03354-.03777-.04577-.01585-.01231-.03431-.02092-.05392-.02531-.01969-.0043-.04008-.0042-.05969 23e-5-3.864769.913077-7.825154 1.370769-11.798615 1.363539-6.838154.0-8.677308-3.209693-9.204-4.546-.423308-1.154846-.692154-2.359462-.799615-3.583308-.0011-.02054.0028-.04108.01115-.05992.0084-.01877.02123-.03538.03731-.04839.01615-.013.03515-.02208.05546-.02646.02031-.0045.04138-.004.06154.0012 3.800385.906846 7.696154 1.364538 11.605615 1.363538.940231.0 1.877693.0 2.818-.02454 3.931923-.109077 8.076154-.308154 11.944693-1.055385.09654-.01908.193-.03546.275769-.06 6.101923-1.159 11.908846-4.796846 12.498923-14.008846.02208-.362692.07723-3.798769.07723-4.175077.0028-1.279.416384-9.072846-.06069-13.861538zm-9.391461 22.98623H45.924141V24.225525c0-3.272462-1.378692-4.941385-4.182923-4.941385-3.082692.0-4.626769 1.974385-4.626769 5.874v8.508385H30.736757V25.15814c0-3.899615-1.546847-5.874-4.629539-5.874-2.787692.0-4.180154 1.668923-4.182923 4.941385V39.769678H15.513526V23.753755c0-3.272461.844692-5.87223 2.534-7.799384 1.742615-1.922539 4.028461-2.909693 6.865769-2.909693 3.283923.0 5.765538 1.248923 7.419923 3.744231l1.596539 2.650692 1.59923-2.650692c1.654385-2.495308 4.136-3.744231 7.414462-3.744231 2.834538.0 5.120308.987154 6.868461 2.909693 1.689385 1.925307 2.534 4.525077 2.534 7.799384z" style="fill-rule:evenodd;clip-rule:evenodd"/></svg></span><span class=new-window><svg height="8" style="enable-background:new 0 0 1000 1000" viewBox="0 0 1e3 1e3" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M598 128h298v298h-86V274L392 692l-60-60 418-418H598v-86zM810 810V512h86v298c0 46-40 86-86 86H214c-48 0-86-40-86-86V214c0-46 38-86 86-86h298v86H214v596h596z" style="fill-rule:evenodd;clip-rule:evenodd"/></svg></span></a><a href=https://github.com/unsign3d target=_blank rel=noopener class="github ananke-social-link link-transition stackoverflow link dib z-999 pt3 pt0-l mr1" title="GitHub link" aria-label="follow on GitHub——Opens in a new window"><span class=icon><svg style="enable-background:new 0 0 512 512" viewBox="0 0 512 512" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M256 32C132.3 32 32 134.8 32 261.7c0 101.5 64.2 187.5 153.2 217.9 11.2 2.1 15.3-5 15.3-11.1.0-5.5-.2-19.9-.3-39.1-62.3 13.9-75.5-30.8-75.5-30.8-10.2-26.5-24.9-33.6-24.9-33.6-20.3-14.3 1.5-14 1.5-14 22.5 1.6 34.3 23.7 34.3 23.7 20 35.1 52.4 25 65.2 19.1 2-14.8 7.8-25 14.2-30.7-49.7-5.8-102-25.5-102-113.5.0-25.1 8.7-45.6 23-61.6-2.3-5.8-10-29.2 2.2-60.8.0.0 18.8-6.2 61.6 23.5 17.9-5.1 37-7.6 56.1-7.7 19 .1 38.2 2.6 56.1 7.7 42.8-29.7 61.5-23.5 61.5-23.5 12.2 31.6 4.5 55 2.2 60.8 14.3 16.1 23 36.6 23 61.6.0 88.2-52.4 107.6-102.3 113.3 8 7.1 15.2 21.1 15.2 42.5.0 30.7-.3 55.5-.3 63 0 6.1 4 13.3 15.4 11C415.9 449.1 480 363.1 480 261.7 480 134.8 379.7 32 256 32z"/></svg></span><span class=new-window><svg height="8" style="enable-background:new 0 0 1000 1000" viewBox="0 0 1e3 1e3" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M598 128h298v298h-86V274L392 692l-60-60 418-418H598v-86zM810 810V512h86v298c0 46-40 86-86 86H214c-48 0-86-40-86-86V214c0-46 38-86 86-86h298v86H214v596h596z" style="fill-rule:evenodd;clip-rule:evenodd"/></svg></span></a></div></div></div></footer></body></html>